<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
<head id="ctl00_Head1">
<script>
   (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-NXDBVV');
  </script>
<title>
   SSW Interop In .NET and How To Avoid DLL Hell
  </title>
<meta content="en-au" http-equiv="Content-Language"/>
<meta content="IE=Edge" http-equiv="X-UA-Compatible"/>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<meta content="SSW, Consultants for software, database and website development, Software development, website development, web development, development, Access, SQL Server, ASP, .net, DotNet, Dot net, ASP.NET, VB.NET, C#, visual basic, database, website, web site, consultants, application, shopping cart, Internet, web, exchange server, sharepoint portal server, sharepoint team services,Database Design Australia, .Net development, sydney Australia, Web Design Australia, website design, web design, IT Services Australia, developers, Database Architect, Software architect, Software solution, Custom database solutions,Custom software solutions, downloads, Website design Australia, Online Database Australia, e-business, web development sydney, website development sydney, CRM, CRM Solution, SharePoint solution, MOSS solution, ebusiness, Sydney, Australia, Sydney Australia, Beijing China, Penang Malaysia, Sao Paulo Brazil" id="ctl00_keywords" name="keywords"/>
<meta content="Angular, React, Vue, Azure, Azure DevOps (was TFS), SharePoint, Office 365, Blazor, .NET, WebAPI, Dynamics 365, and SQL Server. We have software consultants located in Sydney, Brisbane, Melbourne, Newcastle, and China." name="description"/>
<meta content="SSW" name="author"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<link href="/history/css/Content.css" id="ctl00_Link1" media="screen" rel="stylesheet" type="text/css"/>
<link href="/history/css/Screen.css" id="ctl00_screenCSS" media="screen" rel="stylesheet" type="text/css"/>
<link href="/history/Images/icoSSW_2014.ico" rel="shortcut icon"/>
<link href="/history/include/googleSyntax/shCore.css" rel="stylesheet" type="text/css"/>
<link href="/history/include/googleSyntax/shThemeDefault.css" rel="stylesheet" type="text/css"/>
<link href="/history/css/Print.css" id="ctl00_printCSS" media="print" rel="stylesheet" type="text/css"/>
<!-- Start of pdi-ssw Zendesk Widget script -->
<!-- End of pdi-ssw Zendesk Widget script -->
<link href="https://a.omappapi.com/app/js/api.min.css" id="omapi-css" media="all" rel="stylesheet"/>
</head>
<body id="ctl00_MasterBody" style="opacity: 1 !important;">
<div style="
        line-height: 1.5;
        text-align: center; 
        font-size: 1.125rem; 
        color: #999;
        background-color: #333333;
        padding-top: 1.25rem;
        padding-bottom: 1.25rem;
        padding-right: 0.75rem;
        padding-left: 0.75rem;
    ">
<div style="color: white; font-size: 2rem !important; font-weight: 600;">
    ⚠️ This page has been archived
   </div>
<div style="color: white; font-size: 1.125rem !important; font-weight: 600;">
<p style="color:white;">
     ✅ New page with updated info:
     <a href="https://www.ssw.com.au" style="color: white">
      ssw.com.au
     </a>
</p>
</div>
</div>
<noscript>
<iframe height="0" src="https://www.googletagmanager.com/ns.html?id=GTM-NXDBVV" style="display:none;visibility:hidden" width="0">
</iframe>
</noscript>
<form action="./InteropInDotNetAndHowToAvoidDLLHell.aspx" id="aspnetForm" method="post" name="aspnetForm">
<div>
<input id="__VIEWSTATE" name="__VIEWSTATE" type="hidden" value="/wEPDwUKMTM2MDA3ODg2OQ9kFgJmD2QWAgIDD2QWAgIBD2QWCAIDDzwrAAUBAA8WAh4HVmlzaWJsZWhkZAIFDzwrAAUBAA8WAh8AaGRkAgcPPCsABQEADxYCHwBoZGQCCQ9kFgICAw9kFgICBg8PFgQeBFRleHQFiwg8cCBzdHlsZT0iZm9udC1zaXplIDogMTFweDsgY29sb3IgOiAjYWFhIj5UaGVyZSB3YXMgYW4gZXJyb3IgZGlzcGxheWluZyB0aGUgdGVzdGltb25pYWxzLiBQbGVhc2UgPEEgSFJFRj0ibWFpbHRvOmluZm9Acyp3LmNvbS5hdT9TdWJqZWN0PUVycm9yIGRpc3BsYXlpbmcgVGVzdGltb25pYWxzJmJvZHk9IFVSTDogaHR0cHM6Ly9zc3cuY29tLmF1L3Nzdy9TdGFuZGFyZHMvRGV2ZWxvcGVyRG90TmV0L0ludGVyb3BJbkRvdE5ldEFuZEhvd1RvQXZvaWRETExIZWxsLmFzcHgNCg0KJTBEIEVycm9yOiBBIG5ldHdvcmstcmVsYXRlZCBvciBpbnN0YW5jZS1zcGVjaWZpYyBlcnJvciBvY2N1cnJlZCB3aGlsZSBlc3RhYmxpc2hpbmcgYSBjb25uZWN0aW9uIHRvIFNRTCBTZXJ2ZXIuIFRoZSBzZXJ2ZXIgd2FzIG5vdCBmb3VuZCBvciB3YXMgbm90IGFjY2Vzc2libGUuIFZlcmlmeSB0aGF0IHRoZSBpbnN0YW5jZSBuYW1lIGlzIGNvcnJlY3QgYW5kIHRoYXQgU1FMIFNlcnZlciBpcyBjb25maWd1cmVkIHRvIGFsbG93IHJlbW90ZSBjb25uZWN0aW9ucy4gKHByb3ZpZGVyOiBOYW1lZCBQaXBlcyBQcm92aWRlciwgZXJyb3I6IDQwIC0gQ291bGQgbm90IG9wZW4gYSBjb25uZWN0aW9uIHRvIFNRTCBTZXJ2ZXIpIj5yZXBvcnQgdGhpcyBlcnJvcjwvYT4gdG8gU1NXIGFuZCBpbmNsdWRlIHRoZSBmb2xsb3dpbmcgdGV4dDo8YnI+IC0gQSBuZXR3b3JrLXJlbGF0ZWQgb3IgaW5zdGFuY2Utc3BlY2lmaWMgZXJyb3Igb2NjdXJyZWQgd2hpbGUgZXN0YWJsaXNoaW5nIGEgY29ubmVjdGlvbiB0byBTUUwgU2VydmVyLiBUaGUgc2VydmVyIHdhcyBub3QgZm91bmQgb3Igd2FzIG5vdCBhY2Nlc3NpYmxlLiBWZXJpZnkgdGhhdCB0aGUgaW5zdGFuY2UgbmFtZSBpcyBjb3JyZWN0IGFuZCB0aGF0IFNRTCBTZXJ2ZXIgaXMgY29uZmlndXJlZCB0byBhbGxvdyByZW1vdGUgY29ubmVjdGlvbnMuIChwcm92aWRlcjogTmFtZWQgUGlwZXMgUHJvdmlkZXIsIGVycm9yOiA0MCAtIENvdWxkIG5vdCBvcGVuIGEgY29ubmVjdGlvbiB0byBTUUwgU2VydmVyKTwvcD4fAGdkZGQNGrjlQNk1fpD0mzZAMzhfw24mXkeC88wVd0XMxC2LJQ=="/>
</div>
<div>
<input id="__VIEWSTATEGENERATOR" name="__VIEWSTATEGENERATOR" type="hidden" value="9811B597"/>
</div>
<div id="mainContainer">
<div>
</div>
<p>
<span id="ctl00_mainContentPlaceHolder_SiteMapPath1">
<a href="#ctl00_mainContentPlaceHolder_SiteMapPath1_SkipLink">
</a>
<span>
<a href="/ssw/Default.aspx" title="Home">
        Home
       </a>
</span>
<span>
       &gt;
      </span>
<span>
<a href="/ssw/Standards/Default.aspx" title="SSW Standards">
        SSW Standards
       </a>
</span>
<span>
       &gt;
      </span>
<span>
<a href="/ssw/Standards/DeveloperDotNet/Default.aspx" title="Developer .Net">
        Developer .Net
       </a>
</span>
<span>
       &gt;
      </span>
<span>
       SSW Interop In .NET and How To Avoid DLL Hell
      </span>
<a id="ctl00_mainContentPlaceHolder_SiteMapPath1_SkipLink">
</a>
</span>
</p>
<span id="ctl00_mainContentPlaceHolder_testimonial_lblError">
<p style="font-size : 11px; color : #aaa">
      There was an error displaying the testimonials. Please
      <a href="mailto:info@s*w.com.au?Subject=Error displaying Testimonials&amp;body= URL: https://ssw.com.au/ssw/Standards/DeveloperDotNet/InteropInDotNetAndHowToAvoidDLLHell.aspx

%0D Error: A network-related or instance-specific error occurred while establishing a connection to SQL Server. The server was not found or was not accessible. Verify that the instance name is correct and that SQL Server is configured to allow remote connections. (provider: Named Pipes Provider, error: 40 - Could not open a connection to SQL Server)">
       report this error
      </a>
      to SSW and include the following text:
      <br/>
      - A network-related or instance-specific error occurred while establishing a connection to SQL Server. The server was not found or was not accessible. Verify that the instance name is correct and that SQL Server is configured to allow remote connections. (provider: Named Pipes Provider, error: 40 - Could not open a connection to SQL Server)
     </p>
</span>
     
    <h2>
     Goal
    </h2>
<p>
     The goal is to a Visual Basic 6.0 COM component in a .NET Project. E.g. SSWRegistration.dll. Not only do 
			we want to add the component to the project successfully, but we also to avoid distribution problems
			when it becomes time to release the project.
    </p>
<h2>
     Potential Problem
    </h2>
<p>
     Lets say you have .NET Projects that are using the COM component; Project1.NET, Project2.NET 
			and Project3.NET. All of the projects are installed and are using the COM component.
    </p>
<p>
     During the development of Project3.NET, you decide that you need to update the COM component (we are 
			not making any changes to the interface that would break compatibility. E.g. changing the number of 
			parameters in functions).
    </p>
<p>
     So we change the COM component and all of our projects are currently using 'Project Compatibility' so 
			Project3.NET still works but Project1.NET and Project2.NET are no longer working. This is because a new 
			GUID is generated for a COM component using Project Compatibility.
    </p>
<p>
     Note: that if all of these projects were developed in Visual Basic 6 then all of the projects would 
			still work.
    </p>
<p>
     When you add a reference to a COM component in .NET, it generates a file called
     <i>
      Interop.[DLLNAME]
     </i>
     . 
			So when we added a reference to the SSWRegistration.dll COM component, .NET generated a file called 
			Interop.SSWRegistration.dll which, among other things, contains the GUID information for the SSWRegistration.dll.
    </p>
<p>
     When the program needs the COM component, it will search the registry for the GUID stored in the 
			Interop.SSWRegistration.dll file, If the GUID has changed, the search will fail and subsequently 
			will generate an error stating that the COM component could not be found. If the search succeeded
			then the code will be executed.
    </p>
<h2>
     The Solution
    </h2>
<p>
     So we need to be able to control the Interface ID. We don't want this to change because if it does - 
			we will need to generate a new interop each time we create a new version of any of the projects.
    </p>
<p>
     To solve this problem we will need to use the strictist form of compatibility;
     <i>
      Binary Compatibility
     </i>
     . 
			The definition of Binary Compatibility is:
    </p>
<p>
</p>
<blockquote>
<i>
      "the Binary Compatibility option allows you to automatically retain class and interface identifiers 
			from a previous version of a component when you compile a new version. The new version contains both 
			the old identifiers and the new identifiers, and client applications can continue using the old 
			interface to your component without having to be updated."
     </i>
</blockquote>
<p>
</p>
<p>
     So by using Binary Compatibility, Project1.NET and Project2.NET will continue to work after Project3.NET
			is installed.
    </p>
<p>
     To set the COM component to use Binary Compatibility we have to:
    </p>
<ol>
<li>
      Open the COM component project.
     </li>
<li>
      Go to Project | Properties.
     </li>
<li>
      Go to the Component tab.
     </li>
<li>
      Change the Version compatibility to Binary compatibility and specify the location of the DLL.
     </li>
<img alt="Binary Compatability" height="384" src="/history/standards/developer-dot-net/images/img-binary-compatibility.gif" width="418"/>
</ol>
<p>
</p>
<h2>
     The Other Potential Problem
    </h2>
<p>
     With different versions of a file coming to bear, the other problem we are likely to face is the order 
			of the installations. If Project3.NET is using a later version of the COM component and it is installed
			first, then you install Project2.NET which overwrites Project3.NET's COM component then Project3.NET 
			will cease to function properly. The reason for this is Project3.NET's interop is pointing to a GUID
			that doesn't exist in Project2.NET's COM component.
    </p>
<h2>
     The Final Solution
    </h2>
<p>
     The solution to this problem is to only update the COM component if the version is later than the 
			current version. If we need to make changes to the interface then we should rename the DLL so that
			it does not conflict with the old DLL.
     <br/>
<br/>
     E.g.
     <br/>
<br/>
     SSWRegistration_Ver1.dll
     <br/>
     SSWRegistration_Ver2.dll
    </p>
<h2>
     Installing and Uninstalling
    </h2>
<p>
     The final issue we have to address is distribution. When we install our 3 projects, what happens if we
			uninstall one of them? If the COM component is only in one place and is suddenly removed by the 
			uninstaller, then the other projects will no longer work properly.
    </p>
<p>
     To fix this problem we will need to make the COM component a
     <i>
      Shared DLL
     </i>
     . A shared DLL is a dll 
			marked by the operating system as being used by a number of applications and only when all of the 
			applications are removed will the DLL be unregistered and deleted. Product such as Wise offer this 
			functionality by marking it as a "Win95 Shared DLL".
    </p>
<p>
<img alt="Shared dll" height="442" src="/history/standards/developer-dot-net/images/img-shared-dll.gif" width="431"/>
</p>
<p>
     The alternative to this is to check via script that the SharedDLL registry entry is present. This can 
			be found at H_KEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\SharedDLLs.
    </p>
<p>
     If it isn't there then add it and give it a value of 1, otherwise increment the count by 1 if it is 
			there to indicate that another application is using the DLL. When the product is uninstalled it will
			check the count and if it is greater than 1 then it will decrement the count. If the count is 1 then
			it will uninstall the COM component.
    </p>
<h2>
     Conclusion
    </h2>
<p>
     So contrary to what most believe, DLL Hell still exists in .NET and is in some ways harder to handle 
			then in VB6 days. Hopefully we have made you aware of a definite problem with Interop in .NET and how 
			best to handle it.
    </p>
<h2>
     Acknowledgements
    </h2>
<p>
<a href="/ssw/Employees/EmployeesProfile.aspx?EmpID=AC">
      Adam Cogan
     </a>
<br/>
<a href="/ssw/Employees/EmployeesProfile.aspx?EmpID=JP">
      John Prince
     </a>
</p>
<br/>
</div>
<div id="footer">
<p class="callnow">
     Call Now
     <a href="tel:+61299533000">
      +61 2 9953 3000
     </a>
</p>
<span class="copyright">
     © Copyright SSW 1990-2024. All Rights Reserved.
    </span>
<ul>
<li class="first">
<a class="email" href="javascript:sendEmail('696E666F407373772E636F6D2E61753F7375626A6563743D466565646261636B20746F2053535726626F64793D687474703A2F2F7373772E636F6D2E61752F7373772F5374616E64617264732F446576656C6F706572446F744E65742F496E7465726F70496E446F744E6574416E64486F77546F41766F6964444C4C48656C6C2E61737078')" id="ctl00_fC_feedbackHyperLink" tabindex="100">
       Feedback to SSW
      </a>
</li>
<li>
<a href="/ssw/Company/AboutUs.aspx">
       About SSW
      </a>
</li>
<li>
<a href="/ssw/Advertising/Default.aspx">
       Advertising
      </a>
</li>
<li class="last">
<a href="/ssw/MenuMap.aspx">
       Sitemap
      </a>
</li>
</ul>
<span class="proudly">
<a href="http://www.ssw.com.au">
      Proudly developed by SSW Sydney Web Design
     </a>
</span>
<!-- span class="proudlyAjax"><a href="/ssw/Standards/Rules/RulesToBetterWebsitesAdministration.aspx#AJAX">Powered by MS AJAX</a></span -->
<p class="serverName">
     Our website is under constant continuous deployment. Last deployment to AZIIS2022P03. Unable to retrieve changeset details.
    </p>
</div>
</form>
<!--Here's the Google Tracking Code, only available on external servers because we only need to track for external.-->
<!-- This site is converting visitors into subscribers and customers with OptinMonster - http://optinmonster.com -->
<!-- / OptinMonster -->
<div style="visibility: visible;">
<div>
</div>
<div>
</div>
</div>
</body>
</html>
